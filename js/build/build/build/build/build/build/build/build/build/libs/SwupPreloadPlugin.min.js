var n;n=function(){function e(){return e=Object.assign?Object.assign.bind():function(n){for(var a=1;a<arguments.length;a++){var l=arguments[a];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(n[d]=l[d])}return n},e.apply(this,arguments)}const t=n=>String(n).split(".").map(n=>String(parseInt(n||"0",10))).concat(["0","0"]).slice(0,3).join(".");class r{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(n=>n()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([n,a])=>{if(!function(n,a,l){const d=function(n,a){var l;if("swup"===n)return null!=(l=a.version)?l:"";{var d;const l=a.findPlugin(n);return null!=(d=null==l?void 0:l.version)?d:""}}(n,l);return!!d&&((n,a)=>a.every(a=>{const[,l,d]=a.match(/^([\D]+)?(.*)$/)||[];var p,f;return((n,a)=>{const l={"":n=>0===n,">":n=>n>0,">=":n=>n>=0,"<":n=>n<0,"<=":n=>n<=0};return(l[a]||l[""])(n)})((f=d,p=t(p=n),f=t(f),p.localeCompare(f,void 0,{numeric:!0})),l||">=")}))(d,a)}(n,a=Array.isArray(a)?a:[a],this.swup)){const l=`${n} ${a.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${l}`)}}),!0}on(n,a,l={}){var d;a=!(d=a).name.startsWith("bound ")||d.hasOwnProperty("prototype")?a.bind(this):a;const p=this.swup.hooks.on(n,a,l);return this.handlersToUnregister.push(p),p}once(n,a,l={}){return this.on(n,a,e({},l,{once:!0}))}before(n,a,l={}){return this.on(n,a,e({},l,{before:!0}))}replace(n,a,l={}){return this.on(n,a,e({},l,{replace:!0}))}off(n,a){return this.swup.hooks.off(n,a)}}const o=({hash:n}={})=>location.pathname+location.search+(n?location.hash:"");class s extends URL{constructor(n,a=document.baseURI){super(n.toString(),a)}get url(){return this.pathname+this.search}static fromElement(n){const a=n.getAttribute("href")||n.getAttribute("xlink:href")||"";return new s(a)}static fromUrl(n){return new s(n)}}function i(){return window.matchMedia("(hover: hover)").matches}const n=window.requestIdleCallback||(n=>setTimeout(n,1));return class extends r{constructor(n){void 0===n&&(n={}),super();const a=this;this.name="SwupPreloadPlugin",this.requires={swup:">=4"},this.defaults={throttle:5,preloadInitialPage:!0,preloadHoveredLinks:!0,preloadVisibleLinks:{enabled:!1,threshold:.2,delay:500,containers:["body"],ignore:()=>!1}},this.options=void 0,this.queue=void 0,this.preloadObserver=void 0,this.preloadPromises=new Map,this.mouseEnterDelegate=void 0,this.touchStartDelegate=void 0,this.focusDelegate=void 0,this.onPageLoad=(n,a,l)=>{const{url:d}=n.to;return d&&this.preloadPromises.has(d)?this.preloadPromises.get(d):l(n,a)},this.onMouseEnter=function(n){try{if(n.target!==n.delegateTarget)return Promise.resolve();if(!i())return Promise.resolve();const l=n.delegateTarget;return l instanceof HTMLAnchorElement?(a.swup.hooks.callSync("link:hover",{el:l,event:n}),a.preload(l,{priority:!0}),Promise.resolve()):Promise.resolve()}catch(n){return Promise.reject(n)}},this.onTouchStart=n=>{if(i())return;const a=n.delegateTarget;a instanceof HTMLAnchorElement&&this.preload(a,{priority:!0})},this.onFocus=n=>{const a=n.delegateTarget;a instanceof HTMLAnchorElement&&this.preload(a,{priority:!0})};const{preloadVisibleLinks:l,...d}=n;this.options={...this.defaults,...d},"object"==typeof l?this.options.preloadVisibleLinks={...this.options.preloadVisibleLinks,enabled:!0,...l}:this.options.preloadVisibleLinks.enabled=Boolean(l),this.preload=this.preload.bind(this),this.queue=function(n){void 0===n&&(n=1);const a=[],l=[];let d=0,p=0;function i(){p<n&&d>0&&((l.shift()||a.shift()||(()=>{}))(),d--,p++)}return{add:function(n,p){if(void 0===p&&(p=!1),n.__queued){if(!p)return;{const l=a.indexOf(n);if(l>=0){const n=a.splice(l,1);d-=n.length}}}n.__queued=!0,(p?l:a).push(n),d++,d<=1&&i()},next:function(){p--,i()}}}(this.options.throttle)}mount(){const n=this.swup;if(!n.options.cache)return void console.warn("SwupPreloadPlugin: swup cache needs to be enabled for preloading");n.hooks.create("page:preload"),n.hooks.create("link:hover"),n.preload=this.preload,n.preloadLinks=this.preloadLinks;const{linkSelector:a}=n.options,l={passive:!0,capture:!0};this.mouseEnterDelegate=n.delegateEvent(a,"mouseenter",this.onMouseEnter,l),this.touchStartDelegate=n.delegateEvent(a,"touchstart",this.onTouchStart,l),this.focusDelegate=n.delegateEvent(a,"focus",this.onFocus,l),this.replace("page:load",this.onPageLoad),this.options.preloadHoveredLinks&&(this.preloadLinks(),this.on("page:view",()=>this.preloadLinks())),this.options.preloadVisibleLinks.enabled&&(this.preloadVisibleLinks(),this.on("page:view",()=>this.preloadVisibleLinks())),this.options.preloadInitialPage&&this.preload(o())}unmount(){this.swup.preload=void 0,this.swup.preloadLinks=void 0,this.preloadPromises.clear(),this.mouseEnterDelegate?.destroy(),this.touchStartDelegate?.destroy(),this.focusDelegate?.destroy(),this.stopPreloadingVisibleLinks()}preload(n,a){void 0===a&&(a={});try{const l=this;let d,p;const f=a.priority??!1;if(Array.isArray(n))return Promise.all(n.map(n=>l.preload(n)));if(n instanceof HTMLAnchorElement)p=n,({url:d}=s.fromElement(n));else{if("string"!=typeof n)return Promise.resolve();d=n}if(l.preloadPromises.has(d))return Promise.resolve(l.preloadPromises.get(d));if(!l.shouldPreload(d,{el:p}))return Promise.resolve();const m=new Promise(n=>{l.queue.add(()=>{l.performPreload(d).catch(()=>{}).then(a=>n(a)).finally(()=>{l.queue.next(),l.preloadPromises.delete(d)})},f)});return l.preloadPromises.set(d,m),Promise.resolve(m)}catch(n){return Promise.reject(n)}}preloadLinks(){n(()=>{Array.from(document.querySelectorAll("a[data-swup-preload], [data-swup-preload-all] a")).forEach(n=>this.preload(n))})}preloadVisibleLinks(){if(this.preloadObserver)return void this.preloadObserver.update();const{threshold:a,delay:l,containers:d}=this.options.preloadVisibleLinks;this.preloadObserver=function(a){let{threshold:l,delay:d,containers:p,callback:f,filter:m}=a;const g=new Map,v=new IntersectionObserver(n=>{n.forEach(n=>{n.isIntersecting?h(n.target):u(n.target)})},{threshold:l}),h=n=>{const a=g.get(n.href)??new Set;g.set(n.href,a),a.add(n),setTimeout(()=>{const a=g.get(n.href);a?.size&&(f(n),v.unobserve(n),a.delete(n))},d)},u=n=>g.get(n.href)?.delete(n),c=()=>{n(()=>{const n=p.map(n=>`${n} a[href]`).join(", ");Array.from(document.querySelectorAll(n)).filter(n=>m(n)).forEach(n=>v.observe(n))})};return{start:()=>c(),stop:()=>v.disconnect(),update:()=>(g.clear(),c())}}({threshold:a,delay:l,containers:d,callback:n=>this.preload(n),filter:n=>!this.options.preloadVisibleLinks.ignore(n)&&this.shouldPreload(n.href,{el:n})}),this.preloadObserver.start()}stopPreloadingVisibleLinks(){this.preloadObserver&&this.preloadObserver.stop()}shouldPreload(n,a){let{el:l}=void 0===a?{}:a;const{url:d,href:p}=s.fromUrl(n);return!(!function(){if(navigator.connection){if(navigator.connection.saveData)return!1;if(navigator.connection.effectiveType?.endsWith("2g"))return!1}return!0}()||this.swup.cache.has(d)||this.preloadPromises.has(d)||this.swup.shouldIgnoreVisit(p,{el:l})||l&&this.swup.resolveUrl(d)===this.swup.resolveUrl(o()))}performPreload(n){try{const a=this;return Promise.resolve(a.swup.fetchPage(n)).then(function(n){return Promise.resolve(a.swup.hooks.call("page:preload",{page:n})).then(function(){return n})})}catch(n){return Promise.reject(n)}}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(this||self).SwupPreloadPlugin=n();
//# sourceMappingURL=SwupPreloadPlugin.min.js.map
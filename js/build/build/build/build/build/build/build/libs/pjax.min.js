!function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Pjax=t()}(function(){return function r(t,e,n){function o(i,a){if(!e[i]){if(!t[i]){var l="function"==typeof require&&require;if(!a&&l)return l(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=e[i]={exports:{}};t[i][0].call(u.exports,function(e){return o(t[i][1][e]||e)},u,u.exports,r,t,e,n)}return e[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(t,e,n){var s=t("./lib/execute-scripts"),i=t("./lib/foreach-els"),a=t("./lib/parse-options"),l=t("./lib/switches"),c=t("./lib/uniqueid"),u=t("./lib/events/on"),h=t("./lib/events/trigger"),d=t("./lib/util/clone"),p=t("./lib/util/contains"),f=t("./lib/util/extend"),m=t("./lib/util/noop"),Pjax=function(t){this.state={numPendingSwitches:0,href:null,options:null},this.options=a(t),this.log("Pjax options",this.options),this.options.scrollRestoration&&"scrollRestoration"in history&&(history.scrollRestoration="manual"),this.maxUid=this.lastUid=c(),this.parseDOM(document),u(window,"popstate",function(t){if(t.state){var e=d(this.options);e.url=t.state.url,e.title=t.state.title,e.history=!1,e.scrollPos=t.state.scrollPos,t.state.uid<this.lastUid?e.backward=!0:e.forward=!0,this.lastUid=t.state.uid,this.loadUrl(t.state.url,e)}}.bind(this))};if(Pjax.switches=l,Pjax.prototype={log:t("./lib/proto/log"),getElements:function(t){return t.querySelectorAll(this.options.elements)},parseDOM:function(e){var n=t("./lib/proto/parse-element");i(this.getElements(e),n,this)},refresh:function(t){this.parseDOM(t||document)},reload:function(){window.location.reload()},attachLink:t("./lib/proto/attach-link"),attachForm:t("./lib/proto/attach-form"),forEachSelectors:function(e,n,s){return t("./lib/foreach-selectors").bind(this)(this.options.selectors,e,n,s)},switchSelectors:function(e,n,s,i){return t("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,e,n,s,i)},latestChance:function(t){window.location=t},onSwitch:function(){h(window,"resize scroll"),this.state.numPendingSwitches--,0===this.state.numPendingSwitches&&this.afterAllSwitches()},loadContent:function(t,e){if("string"==typeof t){var n=document.implementation.createHTMLDocument("pjax"),s=t.match(/<html[^>]+>/gi);if(s&&s.length&&(s=s[0].match(/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi)).length&&(s.shift(),s.forEach(function(t){var e=t.trim().split("=");1===e.length?n.documentElement.setAttribute(e[0],!0):n.documentElement.setAttribute(e[0],e[1].slice(1,-1))})),n.documentElement.innerHTML=t,this.log("load content",n.documentElement.attributes,n.documentElement.innerHTML.length),document.activeElement&&p(document,this.options.selectors,document.activeElement))try{document.activeElement.blur()}catch(t){}this.switchSelectors(this.options.selectors,n,document,e)}else h(document,"pjax:complete pjax:error",e)},abortRequest:t("./lib/abort-request"),doRequest:t("./lib/send-request"),handleResponse:t("./lib/proto/handle-response"),loadUrl:function(t,e){e="object"==typeof e?f({},this.options,e):d(this.options),this.log("load href",t,e),this.abortRequest(this.request),h(document,"pjax:send",e),this.request=this.doRequest(t,e,this.handleResponse.bind(this))},afterAllSwitches:function(){var t=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();t&&document.activeElement!==t&&t.focus(),this.options.selectors.forEach(function(t){i(document.querySelectorAll(t),function(t){s(t)})});var e=this.state;if(e.options.history&&(window.history.state||(this.lastUid=this.maxUid=c(),window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)),this.lastUid=this.maxUid=c(),window.history.pushState({url:e.href,title:e.options.title,uid:this.maxUid,scrollPos:[0,0]},e.options.title,e.href)),this.forEachSelectors(function(t){this.parseDOM(t)},this),h(document,"pjax:complete pjax:success",e.options),"function"==typeof e.options.analytics&&e.options.analytics(),e.options.history){var n=document.createElement("a");if(n.href=this.state.href,n.hash){var a=n.hash.slice(1);a=decodeURIComponent(a);var l=0,u=document.getElementById(a)||document.getElementsByName(a)[0];if(u&&u.offsetParent)do{l+=u.offsetTop,u=u.offsetParent}while(u);window.scrollTo(0,l)}else!1!==e.options.scrollTo&&(e.options.scrollTo.length>1?window.scrollTo(e.options.scrollTo[0],e.options.scrollTo[1]):window.scrollTo(0,e.options.scrollTo))}else e.options.scrollRestoration&&e.options.scrollPos&&window.scrollTo(e.options.scrollPos[0],e.options.scrollPos[1]);this.state={numPendingSwitches:0,href:null,options:null}}},Pjax.isSupported=t("./lib/is-supported"),Pjax.isSupported())e.exports=Pjax;else{var w=m;for(var b in Pjax.prototype)Pjax.prototype.hasOwnProperty(b)&&"function"==typeof Pjax.prototype[b]&&(w[b]=m);e.exports=w}},{"./lib/abort-request":2,"./lib/events/on":4,"./lib/events/trigger":5,"./lib/execute-scripts":6,"./lib/foreach-els":7,"./lib/foreach-selectors":8,"./lib/is-supported":9,"./lib/parse-options":10,"./lib/proto/attach-form":11,"./lib/proto/attach-link":12,"./lib/proto/handle-response":13,"./lib/proto/log":14,"./lib/proto/parse-element":15,"./lib/send-request":16,"./lib/switches":18,"./lib/switches-selectors":17,"./lib/uniqueid":19,"./lib/util/clone":20,"./lib/util/contains":21,"./lib/util/extend":22,"./lib/util/noop":23}],2:[function(t,e,n){var s=t("./util/noop");e.exports=function(t){t&&t.readyState<4&&(t.onreadystatechange=s,t.abort())}},{"./util/noop":23}],3:[function(t,e,n){e.exports=function(t){var e=t.text||t.textContent||t.innerHTML||"",n=t.src||"",s=t.parentNode||document.querySelector("head")||document.documentElement,i=document.createElement("script");if(e.match("document.write"))return console&&console.log&&console.log("Script contains document.write. Can’t be executed correctly. Code skipped ",t),!1;if(i.type="text/javascript",i.id=t.id,""!==n&&(i.src=n,i.async=!1),""!==e)try{i.appendChild(document.createTextNode(e))}catch(t){i.text=e}return s.appendChild(i),(s instanceof HTMLHeadElement||s instanceof HTMLBodyElement)&&s.contains(i)&&s.removeChild(i),!0}},{}],4:[function(t,e,n){var s=t("../foreach-els");e.exports=function(t,e,n,i){(e="string"==typeof e?e.split(" "):e).forEach(function(e){s(t,function(t){t.addEventListener(e,n,i)})})}},{"../foreach-els":7}],5:[function(t,e,n){var s=t("../foreach-els");e.exports=function(t,e,n){(e="string"==typeof e?e.split(" "):e).forEach(function(e){var i;(i=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),i.eventName=e,n&&Object.keys(n).forEach(function(t){i[t]=n[t]}),s(t,function(t){var e=!1;t.parentNode||t===document||t===window||(e=!0,document.body.appendChild(t)),t.dispatchEvent(i),e&&t.parentNode.removeChild(t)})})}},{"../foreach-els":7}],6:[function(t,e,n){var s=t("./foreach-els"),i=t("./eval-script");e.exports=function(t){"script"===t.tagName.toLowerCase()&&i(t),s(t.querySelectorAll("script"),function(t){t.type&&"text/javascript"!==t.type.toLowerCase()||(t.parentNode&&t.parentNode.removeChild(t),i(t))})}},{"./eval-script":3,"./foreach-els":7}],7:[function(t,e,n){e.exports=function(t,e,n){return t instanceof HTMLCollection||t instanceof NodeList||t instanceof Array?Array.prototype.forEach.call(t,e,n):e.call(n,t)}},{}],8:[function(t,e,n){var s=t("./foreach-els");e.exports=function(t,e,n,i){i=i||document,t.forEach(function(t){s(i.querySelectorAll(t),e,n)})}},{"./foreach-els":7}],9:[function(t,e,n){e.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],10:[function(t,e,n){var s=t("./switches");function defaultAnalytics(){window._gaq&&_gaq.push(["_trackPageview"]),window.ga&&ga("send","pageview",{page:location.pathname,title:document.title})}e.exports=function(t){return(t=t||{}).elements=t.elements||"a[href], form[action]",t.selectors=t.selectors||["title",".js-Pjax"],t.switches=t.switches||{},t.switchesOptions=t.switchesOptions||{},t.history=void 0===t.history||t.history,t.analytics="function"==typeof t.analytics||!1===t.analytics?t.analytics:defaultAnalytics,t.scrollTo=void 0===t.scrollTo?0:t.scrollTo,t.scrollRestoration=void 0===t.scrollRestoration||t.scrollRestoration,t.cacheBust=void 0===t.cacheBust||t.cacheBust,t.debug=t.debug||!1,t.timeout=t.timeout||0,t.currentUrlFullReload=void 0!==t.currentUrlFullReload&&t.currentUrlFullReload,t.switches.head||(t.switches.head=s.switchElementsAlt),t.switches.body||(t.switches.body=s.switchElementsAlt),t}},{"./switches":18}],11:[function(t,e,n){var s=t("../events/on"),i=t("../util/clone"),a="data-pjax-state",formAction=function(t,e){if(!isDefaultPrevented(e)){var n=i(this.options);n.requestOptions={requestUrl:t.getAttribute("action")||window.location.href,requestMethod:t.getAttribute("method")||"GET"};var s=document.createElement("a");s.setAttribute("href",n.requestOptions.requestUrl);var l=function checkIfShouldAbort(t,e){return t.protocol!==window.location.protocol||t.host!==window.location.host?"external":t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,"")?"anchor":t.href===window.location.href.split("#")[0]+"#"?"anchor-empty":e.currentUrlFullReload&&t.href===window.location.href.split("#")[0]?"reload":void 0}(s,n);l?t.setAttribute(a,l):(e.preventDefault(),"multipart/form-data"===t.enctype?n.requestOptions.formData=new FormData(t):n.requestOptions.requestParams=function parseFormElements(t){for(var e=[],n=t.elements,s=0;s<n.length;s++){var i=n[s],a=i.tagName.toLowerCase();if(i.name&&void 0!==i.attributes&&"button"!==a){var l=i.attributes.type;if(!l||"checkbox"!==l.value&&"radio"!==l.value||i.checked){var c=[];if("select"===a)for(var u,h=0;h<i.options.length;h++)(u=i.options[h]).selected&&!u.disabled&&c.push(u.hasAttribute("value")?u.value:u.text);else c.push(i.value);for(var d=0;d<c.length;d++)e.push({name:encodeURIComponent(i.name),value:encodeURIComponent(c[d])})}}}return e}(t),t.setAttribute(a,"submit"),n.triggerElement=t,this.loadUrl(s.href,n))}},isDefaultPrevented=function(t){return t.defaultPrevented||!1===t.returnValue};e.exports=function(t){var e=this;t.setAttribute(a,""),s(t,"submit",function(n){formAction.call(e,t,n)})}},{"../events/on":4,"../util/clone":20}],12:[function(t,e,n){var s=t("../events/on"),i=t("../util/clone"),a="data-pjax-state",linkAction=function(t,e){if(!isDefaultPrevented(e)){var n=i(this.options),s=function checkIfShouldAbort(t,e){return e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey?"modifier":t.protocol!==window.location.protocol||t.host!==window.location.host?"external":t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,"")?"anchor":t.href===window.location.href.split("#")[0]+"#"?"anchor-empty":void 0}(t,e);if(s)t.setAttribute(a,s);else{if(e.preventDefault(),this.options.currentUrlFullReload&&t.href===window.location.href.split("#")[0])return t.setAttribute(a,"reload"),void this.reload();t.setAttribute(a,"load"),n.triggerElement=t,this.loadUrl(t.href,n)}}},isDefaultPrevented=function(t){return t.defaultPrevented||!1===t.returnValue};e.exports=function(t){var e=this;t.setAttribute(a,""),s(t,"click",function(n){linkAction.call(e,t,n)}),s(t,"keyup",function(n){13===n.keyCode&&linkAction.call(e,t,n)}.bind(this))}},{"../events/on":4,"../util/clone":20}],13:[function(t,e,n){var s=t("../util/clone"),i=t("../uniqueid"),a=t("../events/trigger");e.exports=function(t,e,n,l){if((l=s(l||this.options)).request=e,!1!==t){var c=window.history.state||{};window.history.replaceState({url:c.url||window.location.href,title:c.title||document.title,uid:c.uid||i(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var u=n;e.responseURL?n!==e.responseURL&&(n=e.responseURL):e.getResponseHeader("X-PJAX-URL")?n=e.getResponseHeader("X-PJAX-URL"):e.getResponseHeader("X-XHR-Redirected-To")&&(n=e.getResponseHeader("X-XHR-Redirected-To"));var h=document.createElement("a");h.href=u;var d=h.hash;h.href=n,d&&!h.hash&&(h.hash=d,n=h.href),this.state.href=n,this.state.options=l;try{this.loadContent(t,l)}catch(t){if(a(document,"pjax:error",l),this.options.debug)throw t;return console&&console.error&&console.error("Pjax switch fail: ",t),this.latestChance(n)}}else a(document,"pjax:complete pjax:error",l)}},{"../events/trigger":5,"../uniqueid":19,"../util/clone":20}],14:[function(t,e,n){e.exports=function(){this.options.debug&&console&&("function"==typeof console.log?console.log.apply(console,arguments):console.log&&console.log(arguments))}},{}],15:[function(t,e,n){var s="data-pjax-state";e.exports=function(t){switch(t.tagName.toLowerCase()){case"a":t.hasAttribute(s)||this.attachLink(t);break;case"form":t.hasAttribute(s)||this.attachForm(t);break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],16:[function(t,e,n){var s=t("./util/update-query-string");e.exports=function(t,e,n){var i,a=(e=e||{}).requestOptions||{},l=(a.requestMethod||"GET").toUpperCase(),c=a.requestParams||null,u=a.formData||null,h=null,d=new XMLHttpRequest,p=e.timeout||0;if(d.onreadystatechange=function(){4===d.readyState&&(200===d.status?n(d.responseText,d,t,e):0!==d.status&&n(null,d,t,e))},d.onerror=function(s){console.log(s),n(null,d,t,e)},d.ontimeout=function(){n(null,d,t,e)},c&&c.length)switch(i=c.map(function(t){return t.name+"="+t.value}).join("&"),l){case"GET":t=t.split("?")[0],t+="?"+i;break;case"POST":h=i}else u&&(h=u);return e.cacheBust&&(t=s(t,"t",Date.now())),d.open(l,t,!0),d.timeout=p,d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("X-PJAX","true"),d.setRequestHeader("X-PJAX-Selectors",JSON.stringify(e.selectors)),h&&"POST"===l&&!u&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(h),d}},{"./util/update-query-string":24}],17:[function(t,e,n){var s=t("./foreach-els"),i=t("./switches");e.exports=function(t,e,n,a,l,c){var u=[];n.forEach(function(n){var h=a.querySelectorAll(n),d=l.querySelectorAll(n);if(this.log&&this.log("Pjax switch",n,h,d),h.length!==d.length)throw"DOM doesn’t look the same on new loaded page: ’"+n+"’ - new "+h.length+", old "+d.length;s(h,function(s,a){var l=d[a];this.log&&this.log("newEl",s,"oldEl",l);var h=t[n]?t[n].bind(this,l,s,c,e[n]):i.outerHTML.bind(this,l,s,c);u.push(h)},this)},this),this.state.numPendingSwitches=u.length,u.forEach(function(t){t()})}},{"./foreach-els":7,"./switches":18}],18:[function(t,e,n){var s=t("./events/on");e.exports={outerHTML:function(t,e){t.outerHTML=e.outerHTML,this.onSwitch()},innerHTML:function(t,e){t.innerHTML=e.innerHTML,""===e.className?t.removeAttribute("class"):t.className=e.className,this.onSwitch()},switchElementsAlt:function(t,e){if(t.innerHTML=e.innerHTML,e.hasAttributes())for(var n=e.attributes,s=0;s<n.length;s++)t.attributes.setNamedItem(n[s].cloneNode());this.onSwitch()},replaceNode:function(t,e){t.parentNode.replaceChild(e,t),this.onSwitch()},sideBySide:function(t,e,n,i){var a=Array.prototype.forEach,l=[],c=[],u=document.createDocumentFragment(),h="animationend webkitAnimationEnd MSAnimationEnd oanimationend",d=0,p=function(t){t.target===t.currentTarget&&--d<=0&&l&&(l.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)}),c.forEach(function(t){t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")}),c=null,l=null,this.onSwitch())}.bind(this);i=i||{},a.call(t.childNodes,function(t){l.push(t),t.classList&&!t.classList.contains("js-Pjax-remove")&&(t.hasAttribute("data-pjax-classes")&&(t.className=t.className.replace(t.getAttribute("data-pjax-classes"),""),t.removeAttribute("data-pjax-classes")),t.classList.add("js-Pjax-remove"),i.callbacks&&i.callbacks.removeElement&&i.callbacks.removeElement(t),i.classNames&&(t.className+=" "+i.classNames.remove+" "+(n.backward?i.classNames.backward:i.classNames.forward)),d++,s(t,h,p,!0))}),a.call(e.childNodes,function(t){if(t.classList){var e="";i.classNames&&(e=" js-Pjax-add "+i.classNames.add+" "+(n.backward?i.classNames.forward:i.classNames.backward)),i.callbacks&&i.callbacks.addElement&&i.callbacks.addElement(t),t.className+=e,t.setAttribute("data-pjax-classes",e),c.push(t),u.appendChild(t),d++,s(t,h,p,!0)}}),t.className=e.className,t.appendChild(u)}}},{"./events/on":4}],19:[function(t,e,n){var s;e.exports=(s=0,function(){var t="pjax"+(new Date).getTime()+"_"+s;return s++,t})},{}],20:[function(t,e,n){e.exports=function(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},{}],21:[function(t,e,n){e.exports=function contains(t,e,n){for(var s=0;s<e.length;s++)for(var i=t.querySelectorAll(e[s]),a=0;a<i.length;a++)if(i[a].contains(n))return!0;return!1}},{}],22:[function(t,e,n){e.exports=function(t){if(null==t)return null;for(var e=Object(t),n=1;n<arguments.length;n++){var s=arguments[n];if(null!=s)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}},{}],23:[function(t,e,n){e.exports=function(){}},{}],24:[function(t,e,n){e.exports=function(t,e,n){var s=new RegExp("([?&])"+e+"=.*?(&|$)","i"),i=-1!==t.indexOf("?")?"&":"?";return t.match(s)?t.replace(s,"$1"+e+"="+n+"$2"):t+i+e+"="+n}},{}]},{},[1])(1)});
//# sourceMappingURL=pjax.min.js.map
var r;r=function(){function t(){return t=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var c=arguments[l];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(r[h]=c[h])}return r},t.apply(this,arguments)}const o=r=>String(r).split(".").map(r=>String(parseInt(r||"0",10))).concat(["0","0"]).slice(0,3).join(".");class s{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(r=>r()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([r,l])=>{if(!function(r,l,c){const h=function(r,l){var c;if("swup"===r)return null!=(c=l.version)?c:"";{var h;const c=l.findPlugin(r);return null!=(h=null==c?void 0:c.version)?h:""}}(r,c);return!!h&&((r,l)=>l.every(l=>{const[,c,h]=l.match(/^([\D]+)?(.*)$/)||[];var a,u;return((r,l)=>{const c={"":r=>0===r,">":r=>r>0,">=":r=>r>=0,"<":r=>r<0,"<=":r=>r<=0};return(c[l]||c[""])(r)})((u=h,a=o(a=r),u=o(u),a.localeCompare(u,void 0,{numeric:!0})),c||">=")}))(h,l)}(r,l=Array.isArray(l)?l:[l],this.swup)){const c=`${r} ${l.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${c}`)}}),!0}on(r,l,c={}){var h;l=!(h=l).name.startsWith("bound ")||h.hasOwnProperty("prototype")?l.bind(this):l;const a=this.swup.hooks.on(r,l,c);return this.handlersToUnregister.push(a),a}once(r,l,c={}){return this.on(r,l,t({},c,{once:!0}))}before(r,l,c={}){return this.on(r,l,t({},c,{before:!0}))}replace(r,l,c={}){return this.on(r,l,t({},c,{replace:!0}))}off(r,l){return this.swup.hooks.off(r,l)}}const i=(r,l=document)=>Array.from(l.querySelectorAll(r));function n(){return n=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var c=arguments[l];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(r[h]=c[h])}return r},n.apply(this,arguments)}class e{constructor(r){this._raf=null,this._positionY=0,this._velocityY=0,this._targetPositionY=0,this._targetPositionYWithOffset=0,this._direction=0,this.scrollTo=r=>{if(r&&r.nodeType)this._targetPositionY=Math.round(r.getBoundingClientRect().top+window.pageYOffset);else{if(parseInt(this._targetPositionY)!==this._targetPositionY)return void console.error("Argument must be a number or an element.");this._targetPositionY=Math.round(r)}this._targetPositionY>document.documentElement.scrollHeight-window.innerHeight&&(this._targetPositionY=document.documentElement.scrollHeight-window.innerHeight),this._positionY=document.body.scrollTop||document.documentElement.scrollTop,this._direction=this._positionY>this._targetPositionY?-1:1,this._targetPositionYWithOffset=this._targetPositionY+this._direction,this._velocityY=0,this._positionY!==this._targetPositionY?(this.options.onStart(),this._animate()):this.options.onAlreadyAtPositions()},this._animate=()=>{this._update(),this._render(),1===this._direction&&this._targetPositionY>this._positionY||-1===this._direction&&this._targetPositionY<this._positionY?(this._raf=requestAnimationFrame(this._animate),this.options.onTick()):(this._positionY=this._targetPositionY,this._render(),this._raf=null,this.options.onTick(),this.options.onEnd())},this._update=()=>{const r=this._targetPositionYWithOffset-this._positionY;return this._velocityY+=r*this.options.acceleration,this._velocityY*=this.options.friction,this._positionY+=this._velocityY,Math.abs(r)},this._render=()=>{window.scrollTo(0,this._positionY)},this.options=n({},{onAlreadyAtPositions:()=>{},onCancel:()=>{},onEnd:()=>{},onStart:()=>{},onTick:()=>{},friction:.7,acceleration:.04},r),r&&r.friction&&(this.options.friction=1-r.friction),window.addEventListener("mousewheel",r=>{this._raf&&(this.options.onCancel(),cancelAnimationFrame(this._raf),this._raf=null)},{passive:!0})}}return class extends s{constructor(r){var l;void 0===r&&(r={}),super(),l=this,this.name="SwupScrollPlugin",this.requires={swup:">=4.2.0"},this.scrl=void 0,this.defaults={doScrollingRightAway:!1,animateScroll:{betweenPages:!0,samePageWithHash:!0,samePage:!0},scrollFriction:.3,scrollAcceleration:.04,getAnchorElement:void 0,offset:0,scrollContainers:"[data-swup-scroll-container]",shouldResetScrollPosition:()=>!0},this.options=void 0,this.cachedScrollPositions={},this.previousScrollRestoration=void 0,this.currentCacheKey=void 0,this.getAnchorElement=function(r){return void 0===r&&(r=""),"function"==typeof l.options.getAnchorElement?l.options.getAnchorElement(r):l.swup.getAnchorElement(r)},this.getOffset=r=>r?"function"==typeof this.options.offset?parseInt(String(this.options.offset(r)),10):parseInt(String(this.options.offset),10):0,this.handleScrollToTop=()=>(this.swup.scrollTo?.(0,this.shouldAnimate("samePage")),!0),this.handleScrollToAnchor=(r,l)=>{let{hash:c}=l;return this.maybeScrollToAnchor(c,this.shouldAnimate("samePageWithHash"))},this.onVisitStart=r=>{this.maybeResetScrollPositions(r),this.cacheScrollPositions(r.from.url);const l=r.scroll.target||r.to.hash;r.scroll.scrolledToContent=!1,this.options.doScrollingRightAway&&!l&&(r.scroll.scrolledToContent=!0,this.doScrollingBetweenPages(r))},this.onScrollToContent=r=>{r.scroll.scrolledToContent||this.doScrollingBetweenPages(r),this.restoreScrollContainers(r.to.url)},this.doScrollingBetweenPages=r=>{if(r.history.popstate&&!r.animation.animate)return;if(this.maybeScrollToAnchor(r.scroll.target||r.to.hash,this.shouldAnimate("betweenPages")))return;if(!r.scroll.reset)return;const l=this.getCachedScrollPositions(this.swup.resolveUrl((({hash:r}={})=>location.pathname+location.search+(r?location.hash:""))())),c=l?.window?.top||0;requestAnimationFrame(()=>this.swup.scrollTo?.(c,this.shouldAnimate("betweenPages")))},this.maybeResetScrollPositions=r=>{const{url:l}=r.to,{el:c}=r.trigger;c&&this.options.shouldResetScrollPosition(c)&&this.resetScrollPositions(l)},this.options={...this.defaults,...r}}mount(){var r=this;const l=this.swup;l.hooks.create("scroll:start"),l.hooks.create("scroll:end"),this.scrl=new e({onStart:()=>l.hooks.callSync("scroll:start"),onEnd:()=>l.hooks.callSync("scroll:end"),onCancel:()=>l.hooks.callSync("scroll:end"),friction:this.options.scrollFriction,acceleration:this.options.scrollAcceleration}),l.scrollTo=function(c,h){void 0===h&&(h=!0),h?r.scrl.scrollTo(c):(l.hooks.callSync("scroll:start"),window.scrollTo(0,c),l.hooks.callSync("scroll:end"))},this.previousScrollRestoration=window.history.scrollRestoration,l.options.animateHistoryBrowsing&&(window.history.scrollRestoration="manual"),this.on("visit:start",this.onVisitStart),this.replace("content:scroll",this.onScrollToContent),this.replace("scroll:top",this.handleScrollToTop),this.replace("scroll:anchor",this.handleScrollToAnchor)}unmount(){super.unmount(),this.previousScrollRestoration&&(window.history.scrollRestoration=this.previousScrollRestoration),this.cachedScrollPositions={},delete this.swup.scrollTo,delete this.scrl}shouldAnimate(r){return"boolean"==typeof this.options.animateScroll?this.options.animateScroll:this.options.animateScroll[r]}maybeScrollToAnchor(r,l){if(void 0===l&&(l=!1),!r)return!1;const c=this.getAnchorElement(r);if(!c)return console.warn(`Anchor target ${r} not found`),!1;if(!(c instanceof Element))return console.warn(`Anchor target ${r} is not a DOM node`),!1;const{top:h}=c.getBoundingClientRect(),a=h+window.scrollY-this.getOffset(c);return this.swup.scrollTo?.(a,l),!0}cacheScrollPositions(r){const l=i(this.options.scrollContainers).map(r=>({top:r.scrollTop,left:r.scrollLeft})),c={window:{top:window.scrollY,left:window.scrollX},containers:l};this.cachedScrollPositions[r]=c}resetScrollPositions(r){const l=this.swup.resolveUrl(r);delete this.cachedScrollPositions[l]}getCachedScrollPositions(r){const l=this.swup.resolveUrl(r);return this.cachedScrollPositions[l]}restoreScrollContainers(r){const l=this.getCachedScrollPositions(r);l&&0!==l.containers.length&&i(this.options.scrollContainers).forEach((r,c)=>{const h=l.containers[c];null!=h&&(r.scrollTop=h.top,r.scrollLeft=h.left)})}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(this||self).SwupScrollPlugin=r();
//# sourceMappingURL=SwupScrollPlugin.min.js.map
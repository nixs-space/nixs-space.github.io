var r,n;r=this,n=function(){function t(){return t=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])}return r},t.apply(this,arguments)}const e=r=>String(r).split(".").map(r=>String(parseInt(r||"0",10))).concat(["0","0"]).slice(0,3).join(".");class s{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(r=>r()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([r,n])=>{if(!function(r,n,o){const a=function(r,n){var o;if("swup"===r)return null!=(o=n.version)?o:"";{var a;const o=n.findPlugin(r);return null!=(a=null==o?void 0:o.version)?a:""}}(r,o);return!!a&&((r,n)=>n.every(n=>{const[,o,a]=n.match(/^([\D]+)?(.*)$/)||[];var h,l;return((r,n)=>{const o={"":r=>0===r,">":r=>r>0,">=":r=>r>=0,"<":r=>r<0,"<=":r=>r<=0};return(o[n]||o[""])(r)})((l=a,h=e(h=r),l=e(l),h.localeCompare(l,void 0,{numeric:!0})),o||">=")}))(a,n)}(r,n=Array.isArray(n)?n:[n],this.swup)){const o=`${r} ${n.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${o}`)}}),!0}on(r,n,o={}){var a;n=!(a=n).name.startsWith("bound ")||a.hasOwnProperty("prototype")?n.bind(this):n;const h=this.swup.hooks.on(r,n,o);return this.handlersToUnregister.push(h),h}once(r,n,o={}){return this.on(r,n,t({},o,{once:!0}))}before(r,n,o={}){return this.on(r,n,t({},o,{before:!0}))}replace(r,n,o={}){return this.on(r,n,t({},o,{replace:!0}))}off(r,n){return this.swup.hooks.off(r,n)}}class i{constructor(r){let{className:n,styleAttr:o,animationDuration:a,minValue:h,initialValue:l,trickleValue:u}=void 0===r?{}:r;this.value=0,this.visible=!1,this.hiding=!1,this.className="progress-bar",this.styleAttr="data-progressbar-styles data-swup-theme",this.animationDuration=300,this.minValue=.1,this.initialValue=.25,this.trickleValue=.03,this.trickleInterval=void 0,this.styleElement=void 0,this.progressElement=void 0,this.trickle=()=>{const r=Math.random()*this.trickleValue;this.setValue(this.value+r)},void 0!==n&&(this.className=String(n)),void 0!==o&&(this.styleAttr=String(o)),void 0!==a&&(this.animationDuration=Number(a)),void 0!==h&&(this.minValue=Number(h)),void 0!==l&&(this.initialValue=Number(l)),void 0!==u&&(this.trickleValue=Number(u)),this.styleElement=this.createStyleElement(),this.progressElement=this.createProgressElement()}get defaultStyles(){return`\n\t\t.${this.className} {\n\t\t\tposition: fixed;\n\t\t\tdisplay: block;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\theight: 3px;\n\t\t\tbackground-color: black;\n\t\t\tz-index: 9999;\n\t\t\ttransition:\n\t\t\t\twidth ${this.animationDuration}ms ease-out,\n\t\t\t\topacity ${this.animationDuration/2}ms ${this.animationDuration/2}ms ease-in;\n\t\t\ttransform: translate3d(0, 0, 0);\n\t\t}\n\t`}show(){this.visible||(this.visible=!0,this.installStyleElement(),this.installProgressElement(),this.startTrickling())}hide(){this.visible&&!this.hiding&&(this.hiding=!0,this.fadeProgressElement(()=>{this.uninstallProgressElement(),this.stopTrickling(),this.visible=!1,this.hiding=!1}))}setValue(r){this.value=Math.min(1,Math.max(this.minValue,r)),this.refresh()}installStyleElement(){document.head.insertBefore(this.styleElement,document.head.firstChild)}installProgressElement(){this.progressElement.style.width="0%",this.progressElement.style.opacity="1",document.documentElement.insertBefore(this.progressElement,document.body),this.progressElement.scrollTop=0,this.setValue(Math.random()*this.initialValue)}fadeProgressElement(r){this.progressElement.style.opacity="0",setTimeout(r,1.5*this.animationDuration)}uninstallProgressElement(){this.progressElement.parentNode&&document.documentElement.removeChild(this.progressElement)}startTrickling(){this.trickleInterval||(this.trickleInterval=window.setInterval(this.trickle,this.animationDuration))}stopTrickling(){window.clearInterval(this.trickleInterval),delete this.trickleInterval}refresh(){requestAnimationFrame(()=>{this.progressElement.style.width=100*this.value+"%"})}createStyleElement(){const r=document.createElement("style");return this.styleAttr.split(" ").forEach(n=>r.setAttribute(n,"")),r.textContent=this.defaultStyles,r}createProgressElement(){const r=document.createElement("div");return r.className=this.className,r}}return class extends s{constructor(r){void 0===r&&(r={}),super(),this.name="SwupProgressPlugin",this.defaults={className:"swup-progress-bar",delay:300,transition:300,minValue:.1,initialValue:.25,finishAnimation:!0},this.options=void 0,this.progressBar=void 0,this.showProgressBarTimeout=void 0,this.hideProgressBarTimeout=void 0,this.options={...this.defaults,...r};const{className:n,minValue:o,initialValue:a,transition:h}=this.options;this.progressBar=new i({className:n,minValue:o,initialValue:a,animationDuration:h})}mount(){this.on("visit:start",this.startShowingProgress),this.on("page:view",this.stopShowingProgress)}startShowingProgress(){this.progressBar.setValue(0),this.showProgressBarAfterDelay()}stopShowingProgress(){this.progressBar.setValue(1),this.options.finishAnimation?this.finishAnimationAndHideProgressBar():this.hideProgressBar()}showProgressBar(){this.cancelHideProgressBarTimeout(),this.progressBar.show()}showProgressBarAfterDelay(){this.cancelShowProgressBarTimeout(),this.cancelHideProgressBarTimeout(),this.showProgressBarTimeout=window.setTimeout(this.showProgressBar.bind(this),this.options.delay)}hideProgressBar(){this.cancelShowProgressBarTimeout(),this.progressBar.hide()}finishAnimationAndHideProgressBar(){this.cancelShowProgressBarTimeout(),this.hideProgressBarTimeout=window.setTimeout(this.hideProgressBar.bind(this),this.options.transition)}cancelShowProgressBarTimeout(){window.clearTimeout(this.showProgressBarTimeout),delete this.showProgressBarTimeout}cancelHideProgressBarTimeout(){window.clearTimeout(this.hideProgressBarTimeout),delete this.hideProgressBarTimeout}}},"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(r||self).SwupProgressPlugin=n();
//# sourceMappingURL=SwupProgressPlugin.min.js.map